<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/bower_components/iron-pages/iron-pages.html">
<link rel="import" href="/markdown-page.html">
<dom-module id="listing-page">
  <style>
    span {
      float: right;
    }
  </style>
  <template>
    <iron-ajax
      auto
      url="/{{page}}/listing.json"
      handle-as="json"
      last-response="{{listing}}">
    </iron-ajax>
    <iron-pages attr-for-selected="page" selected="listing/{{path}}" fallback-selection="markdown">
      <div page="listing/">
        <h1>{{page}}</h1>
        <template is="dom-repeat" items="{{listing}}" sort="sort">
          <p>
            <span>{{item.date}}</span>
            <a href="#/{{item.path}}">{{item.title}}</a>
          </p>
        </template>
      </div>
      <markdown-page page="markdown" markdown-path="{{markdownPath}}"></markdown-page>
    </iron-pages>
  </template>
  <script>
    Polymer({
      is: 'listing-page',
      properties: {
        page: String,
        path: String,
        sortBy: String,
        sortDesc: Boolean,
        markdownPath: {
          type: String,
          computed: 'computeMarkdownPath(page, path)'
        }
      },
      computeMarkdownPath: function(page, path) {
        return path ? '/' + page + '/' + path + '.markdown' : '';
      },
      sort: function(a, b) {
        var result = 0;
        if (a[this.sortBy] < b[this.sortBy])
          result = -1;
        else if (a[this.sortBy] > b[this.sortBy])
          result = 1;
        return this.sortDesc ? -result : result;
      }
    });
  </script>
</dom-module>
