<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="style-module.html">
<dom-module id="listing-page">
  <template>
    <style include="style-module">
    span {
      float: right;
    }
    </style>
    <iron-ajax id="xhr" url="/content[[path]]/listing.json" handle-as="json" last-response="{{listing}}"></iron-ajax>
    <div>
      <h2>[[title]]</h2>
      <template is="dom-repeat" items="[[listing]]" sort="sort">
        <p>
          <template is="dom-if" if="[[item.date]]">
            <span>[[item.date]]</span>
          </template>
          <a href="#/[[item.path]]">[[item.title]]</a>
          <template is="dom-if" if="[[item.snippet]]">
            &nbsp;- [[item.snippet]]
          </template>
        </p>
      </template>
    </div>
  </template>
  <script>
  class ListingPage extends Polymer.Element {
    static get is() { return 'listing-page'; }
    static get properties() { return {
      title: String,
      path: String,
      sortBy: String,
      sortDesc: Boolean,
      visible: {
        type: Boolean,
        observer: 'visibleChanged'
      }
    }}
    visibleChanged(visible) {
      if (visible && !this.listing) {
        this.$.xhr.generateRequest();
      }
    }
    sort(a, b) {
      var result = 0;
      if (a[this.sortBy] < b[this.sortBy])
        result = -1;
      else if (a[this.sortBy] > b[this.sortBy])
        result = 1;
      return this.sortDesc ? -result : result;
    }
  }
  customElements.define(ListingPage.is, ListingPage);
  </script>
</dom-module>
